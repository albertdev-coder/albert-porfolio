---
import { Icon } from "astro-icon/components";

const contactInfo = [
  {
    icon: "lucide:map-pin",
    label: "Location",
    value: "Based in Cuba — Open to Remote Work Worldwide",
    link: null,
  },
  {
    icon: "lucide:linkedin",
    label: "LinkedIn",
    value: "/in/alberto-cisneros",
    link: "https://www.linkedin.com/in/alberto-cisneros-7430b23a2/",
  },
];
---

<section id="contact" class="relative py-32">
  <div class="container-custom">
    <!-- Header -->
    <div class="text-center mb-16" data-animate="fade-in">
      <h2 class="text-4xl md:text-5xl font-bold mb-4">
        <span class="text-gradient">Get In Touch</span>
      </h2>
      <div
        class="h-1 w-20 mx-auto bg-gradient-to-r from-crystal-cyan to-crystal-blue rounded-full mb-6"
      >
      </div>
      <p class="text-lg text-text-tertiary max-w-2xl mx-auto">
        Interested in working together or discussing a remote opportunity? Feel
        free to reach out — I’m always open to meaningful collaborations.
      </p>
    </div>

    <div class="max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Contact Form -->
      <div
        class="glass rounded-2xl p-8 crystal-glow"
        data-animate="slide-up"
        data-delay="200"
      >
        <h3 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <Icon name="lucide:send" class="w-6 h-6 text-crystal-cyan" />
          Send a Message
        </h3>

        <form class="space-y-6" id="contact-form">
          <div>
            <label
              for="name"
              class="block text-sm font-medium text-text-secondary mb-2"
            >
              Your Name
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full glass glass-hover px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-crystal-cyan transition-all text-text-primary"
              placeholder="John Doe"
            />
          </div>

          <div>
            <label
              for="email"
              class="block text-sm font-medium text-text-secondary mb-2"
            >
              Email Address
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full glass glass-hover px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-crystal-cyan transition-all text-text-primary"
              placeholder="john@example.com"
            />
          </div>

          <div>
            <label
              for="message"
              class="block text-sm font-medium text-text-secondary mb-2"
            >
              Message
            </label>
            <textarea
              id="message"
              name="message"
              required
              rows="5"
              class="w-full glass glass-hover px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-crystal-cyan transition-all text-text-primary resize-none"
              placeholder="Tell me about your project or opportunity..."
            ></textarea>
          </div>

          <button
            type="submit"
            class="w-full glass glass-hover px-6 py-4 rounded-lg font-semibold transition-all duration-300 crystal-glow-cyan hover:scale-105 flex items-center justify-center gap-2"
          >
            <Icon name="lucide:send" class="w-5 h-5" />
            Send Message
          </button>
        </form>
      </div>

      <!-- Contact Info & Socials -->
      <div class="space-y-6" data-animate="slide-up" data-delay="400">
        <!-- Contact Info Cards -->
        <div class="space-y-4">
          {
            contactInfo.map((info) => (
              <div class="glass rounded-xl p-6 transition-all duration-300 hover:crystal-glow-purple hover:scale-105">
                <div class="flex items-start gap-4">
                  <div class="w-12 h-12 rounded-lg glass flex items-center justify-center shrink-0">
                    <Icon name={info.icon} class="w-6 h-6 text-crystal-cyan" />
                  </div>
                  <div>
                    <div class="text-sm text-text-tertiary mb-1">
                      {info.label}
                    </div>
                    {info.link ? (
                      <a
                        href={info.link}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-text-primary font-semibold hover:text-crystal-cyan transition-colors"
                      >
                        {info.value}
                      </a>
                    ) : (
                      <div class="text-text-primary font-semibold">
                        {info.value}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        <!-- Social Links -->
        <div class="glass rounded-xl p-6">
          <h4 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <Icon name="lucide:share-2" class="w-5 h-5 text-crystal-purple" />
            Connect Online
          </h4>
          <div class="grid grid-cols-3 gap-3">
            {
              [
                {
                  name: "GitHub",
                  icon: "lucide:github",
                  link: "https://github.com/albertdev-coder",
                },
                {
                  name: "LinkedIn",
                  icon: "lucide:linkedin",
                  link: "https://www.linkedin.com/in/alberto-cisneros-7430b23a2/",
                },
              ].map((social) => (
                <a
                  href={social.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="glass glass-hover p-4 rounded-lg flex flex-col items-center gap-2 transition-all duration-300 hover:crystal-glow hover:scale-110"
                  aria-label={social.name}
                >
                  <Icon name={social.icon} class="w-6 h-6 text-crystal-cyan" />
                  <span class="text-xs text-text-tertiary">{social.name}</span>
                </a>
              ))
            }
          </div>
        </div>

        <!-- Availability -->
        <div class="glass rounded-xl p-6">
          <div class="flex items-center gap-3">
            <div class="relative">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse">
              </div>
              <div
                class="absolute inset-0 w-3 h-3 bg-green-500 rounded-full animate-ping"
              >
              </div>
            </div>
            <div>
              <div class="text-text-primary font-semibold">
                Open to Remote Opportunities
              </div>
              <div class="text-sm text-text-tertiary">
                Available for internships, junior roles, and collaborative
                projects
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script type="module">
  const form = document.getElementById("contact-form");

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const res = await fetch("/api/send-email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await res.json();
      if (res.ok) {
        alert("Thank you! Your message has been sent.");
        form.reset();
      } else {
        alert("Oops! " + result.error);
      }
    } catch (err) {
      console.error(err);
      alert("Something went wrong. Please try again later.");
    }
  });

  // Intersection Observer for animations
  const observerOptions = { threshold: 0.1, rootMargin: "0px 0px -100px 0px" };
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const delay = entry.target.getAttribute("data-delay") || "0";
        setTimeout(
          () => entry.target.classList.add("animate-in"),
          parseInt(delay),
        );
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document
    .querySelectorAll("#contact [data-animate]")
    .forEach((el) => observer.observe(el));
</script>

<style>
  #contact [data-animate] {
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.8s ease-out,
      transform 0.8s ease-out;
  }
  #contact [data-animate].animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  textarea::-webkit-scrollbar {
    width: 8px;
  }
  textarea::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
  }
  textarea::-webkit-scrollbar-thumb {
    background: rgba(59, 130, 246, 0.5);
    border-radius: 4px;
  }
  textarea::-webkit-scrollbar-thumb:hover {
    background: rgba(59, 130, 246, 0.7);
  }
</style>
